---
title: kiftd使用docker部署
date: 2023-11-24 10:55:40
permalink: /pages/989bc1/
categories:
  - 开源项目
tags:
  - 
author: 
  name: 华总
  link: https://liyao52033.github.io/
titleTag: 原创
---
## 1 在/usr/local/kiftd下新建文件夹，后续文件都在此目录

## 2 上传[kiftd](https://kohgylw.gitee.io/)文件到/usr/local/kiftd下

## 3 新建Dockerfile如下

::: tip 提示

Dockerfile必须根文件同一目录，如果只有一个jar包，则跟jar包同一个目录；

:::

```dockerfile
# 使用jdk8镜像
FROM openjdk:8-jre-alpine

# 设置工作目录
WORKDIR /app

# 将kiftd-1.1.1-release文件夹拷贝到工作目录下,最后一个/表示是目录
# 如果只有一个jar包，则为COPY kiftd.jar /app/kiftd.jar
COPY kiftd-1.1.1-release/ /app/kiftd-1.1.1-release/

# 暴露端口
EXPOSE 8080

# 启动程序，如果只有一个jar包，则为 "/app/kiftd.jar"
CMD ["java","-jar","/app/kiftd-1.1.1-release/kiftd.jar","-start"]
```

## 4  新建kiftd-start.sh如下

```sh
# 创建的docker部署根目录
SOURCE_PATH=/usr/local/kiftd

# 镜像名称
SERVER_NAME=kiftd/docker
# 版本
TAG=latest
# 端口号
SERVER_PORT=8080

# 设置时区
RUN rm -f /etc/localtime \
&& ln -sv /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
&& echo "Asia/Shanghai" > /etc/timezone


CID=$(docker ps | grep "$SERVER_NAME" | awk '{print $1}')
IID=$(docker images | grep "$SERVER_NAME" | awk '{print $3}')
if [ -n "$CID" ]; then
  echo "存在容器$SERVER_NAME,CID-$CID"
  docker stop $CID
  echo "成功停止容器$SERVER_NAME,CID-$CID"
  docker rm $CID
  echo "成功删除容器$SERVER_NAME,CID-$CID"
fi
if [ -n "$IID" ]; then
  echo "存在镜像$SERVER_NAME:$TAG,IID=$IID"
  docker rmi $IID
  echo "成功删除镜像$SERVER_NAME:$TAG,IID=$IID"
fi
echo "开始构建镜像$SERVER_NAME:$TAG"
# 进入创建的docker部署根目录
cd $SOURCE_PATH
# 构建docker镜像
docker build -t $SERVER_NAME:$TAG .
echo "成功构建镜像$SERVER_NAME:$TAG"

# 运行docker容器
docker run --restart=always --name=kiftd -d -p 8080:8080 --privileged=true kiftd/docker:latest

echo "成功创建并运行容器$SERVER_NAME"
```

