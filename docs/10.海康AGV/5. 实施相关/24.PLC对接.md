---
title: PLC对接
date: 2024-01-13 19:24:09
permalink: /pages/b87f2b/
categories:
  - 海康AGV
  -  实施相关
tags:
  - 
author: 
  name: 华总
  link: https://xiaoying.org.cn/
titleTag: 原创
---
><span style='color:red;font-size:25px;'>调试上线大致过程</span>
>
>1、现场设备安装部署、改造完成、网络部署完成(检查：服务器网络到设备控制 器网络通畅) 
>
>2、 设备厂家完成自测，基本动作能够正常执行，通过工具发送指令能够正常执 行相应动作，并且给回复信息(设备厂家执行) 项目前期同设备厂家确认协议后，通常会发送测试工具和测试方法给到对方， 要求其进行自测。项目现场准备调试之前要同设备厂家确认其是否执行完成。 
>
>3、 研发提供对应项目测试文档、工具给到现场，现场通过工具发送指令对现场 设备进行单步验证，参考[电梯配置](http://www.v-club.com/home/article/9098) 
>
>4、 系统任务模板配置、外设信息添加，任务模板验证
>
>5、 整体联调，平台触发相关任务(任务调度、PDA 等)，测试维稳。 
>
>`本文主要讲第四点，可以结合现场实际情况，提前进行准备`。其他 1235 通常建议严格 按照顺序执行。也许很多人会问，为什么设定第三步而不是直接配置系统、整体 联调？因为这是一个多方对接的场景，通过第三步可以对之前的结果进行检验， 将尽可能多的设备相关的问题控制在尽量小的排查范围，而不是等联调起来之后 从上至下排查一遍进行问题定位，由此降低后续复杂度，为后续的 AGV 联动提 供保障，通常工具测试不通过，不建议执行第五步。

##  1、应用注册

路径

```sh
/wcs/services/rest/cms/agvCallback
```

IP即为WCS的IP，端口默认8090

![image-20240113194102298](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131941605.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146081;9000000000&q-key-time=1705146081;9000000000&q-header-list=host&q-url-param-list=&q-signature=b3d1c08f1cc3e0293f84cc186048787250c10e31)

##  2、配置CMS系统参数第三方对接的IP和端口

取消任务自动通知WCS(否则会导致WCS任务残留，后续任务执行异常)，需要配置CMS系统参数第三方对接的IP和端口，基础路径

IP

8090端口

```sh
/wcs/services/rest/cms/agvCallback
```

![image-20240113194354491](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131943544.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146234;9000000000&q-key-time=1705146234;9000000000&q-header-list=host&q-url-param-list=&q-signature=8343882e3722d05c0301904ef617fa9a8ec7675a)

##  3、替换json文件
根据现场情况编辑wcs_protocol_message.json与wcs_device_local.json文件，用secureFX将json文件替换到WCS bin目录，重启wcs服务


![image-20240113194526988](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131945043.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146326;8999999999&q-key-time=1705146326;8999999999&q-header-list=host&q-url-param-list=&q-signature=7ea8224420476a2c876e57e504435579ee6c265d)

##  4、**外设编辑**

根据wcs_protocol_message.json文件的注释内容进行相关外设配置,外设序号与文件cmsIndex序号一致

##  5、**wcs能力集配置**

第1点中的应用注册添加后，应用注册列表会有一个令牌号列，将令牌号和编号设置到wcs能力集中的令牌号中，一定要配置，不然会导致wcs接口调用失败。

## 6、 **任务模板注意事项**

根据配置文件添加任务模板，任务编号名称与下图红框一致，任务模板根据送料、接料不同方法配置也不同

agv接料： 申请点位(toAgv)-\>工作台(arrived)-\>接料完成释放(release)

agv送料 申请点位(fromAgv)-\>工作台(arrived)-\>接料完成释放(release)

`注意！ 各种方法小车所在位置的呼叫站点必须是方法对应设备的编号！否则接口会调用失败，不仅仅是toAgv ，我是说上面列出的所有的方法！`

![image-20240113194619361](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131946411.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146379;9000000000&q-key-time=1705146379;9000000000&q-header-list=host&q-url-param-list=&q-signature=ece78b548a7f0530644800322687ede173a08825)

![image-20240113194636832](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131946887.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146396;8999999999&q-key-time=1705146396;8999999999&q-header-list=host&q-url-param-list=&q-signature=1ca2b4ca37d50066e2905879080c6286fac41346) 

![image-20240113194659746](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131946790.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146419;9000000000&q-key-time=1705146419;9000000000&q-header-list=host&q-url-param-list=&q-signature=aff568d8192d4f82452e25e1fcb7dff1bc6b0e41)

## 7、 **任务模板配置**

a、点到区域

 ![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947822.jpg?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146466;8999999999&q-key-time=1705146466;8999999999&q-header-list=host&q-url-param-list=&q-signature=d5251ffcc6823589c49a66bb7165b9207e392d60)

向后关联地图要做相应调整

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947803.jpg?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146466;8999999999&q-key-time=1705146466;8999999999&q-header-list=host&q-url-param-list=&q-signature=d4290883bc1143b4d0113bb3ceb4efd246c30844)

 

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947814.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146467;9000000000&q-key-time=1705146467;9000000000&q-header-list=host&q-url-param-list=&q-signature=bf152db9f6a9c9f4de783527f400523cc8bf9fb9)

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947809.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146467;9000000000&q-key-time=1705146467;9000000000&q-header-list=host&q-url-param-list=&q-signature=1472cc208f39914b685c731e7bf40297381c3b6b)

 

向前关联地图更改

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947808.jpg?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146466;8999999999&q-key-time=1705146466;8999999999&q-header-list=host&q-url-param-list=&q-signature=26ae7ba0ce9805a004d7bde0eef9de6d8d6d6232)

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947829.jpg?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146466;8999999999&q-key-time=1705146466;8999999999&q-header-list=host&q-url-param-list=&q-signature=e7fadf9c57174a87d1aaa0e7423fbd7267601865)

b、区域到点

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947167.jpg?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146467;9000000000&q-key-time=1705146467;9000000000&q-header-list=host&q-url-param-list=&q-signature=e6d85b458ef42a40f0486079f8c9545006aab255)

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947369.jpg?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146467;9000000000&q-key-time=1705146467;9000000000&q-header-list=host&q-url-param-list=&q-signature=c575e0fe4dc9830063e51ddd2a83f4b9591c45e4)

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947792.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146468;9000000000&q-key-time=1705146468;9000000000&q-header-list=host&q-url-param-list=&q-signature=2adc1fde1cf3951d69034a3d9a3d07ac21e8b052)

## 8、  运管中心重启wcs

## 9、 WCS任务状态查看

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947848.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146468;9000000000&q-key-time=1705146468;9000000000&q-header-list=host&q-url-param-list=&q-signature=390e6eef1caab049d30978822a0cf26ef4ff4865)

## 10、异常处理

![img](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131947042.png?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705146468;9000000000&q-key-time=1705146468;9000000000&q-header-list=host&q-url-param-list=&q-signature=9b25d5f0f579d35b5b8cbc176f83cdfe46853cdd)

参考文档

[控制器串口对接第三方设备](http://www.v-club.com/home/article/1980)

[电梯类上线详细说明手册](https://aurora-1258839075.cos.ap-shanghai.myqcloud.com/img/202401131959904.pdf?q-sign-algorithm=sha1&q-ak=AKIDlOsIWjolbMzQrQyRwNfoovASl088zhGh&q-sign-time=1705147200;9000000000&q-key-time=1705147200;9000000000&q-header-list=host&q-url-param-list=&q-signature=9473ac010345a0bd34281903ba3c27eaab428570)



